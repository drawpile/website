{% extends "pages/help/_base.html" %}

{% load commonmark %}

{% block title %}Dedicated Server HOWTO - {{ block.super }}{% endblock %}

{% block content %}
<article class="content">
{% filter commonmark_full %}
# Dedicated Server HOWTO

This is a step-by-step instruction guide to setting up your own Drawpile server
on a cheap cloud Linux server, using the Docker based [all-in-one installer script](https://github.com/drawpile/dpserver).

The following knowledge is assumed:

 * Basic Linux command line
 * How to connect to a server using SSH
 * How to use a text editor in Linux

## Step 1. Get a (virtual) server

First, you will need an actual server to run the server software on. Drawpile-srv is not
very demanding, so a tiny $5/month server from [Linode](https://www.linode.com/) or [Digital Ocean](https://www.digitalocean.com/) or any other cloud VPS provider will do just fine. You can also use a physical machine at home (even a Raspberry Pi!) but in this case you will need to ensure your Internet connection is up to the task.

When creating the server, you must choose which Linux distribution to use. In this tutorial, I will use **Debian 10 (Buster)**.

<div class="message is-info">
<div class="message-body">
Tip: before renting a real server, you can practice by <a href="https://www.debian.org/distrib/netinst">downloading Debian</a> and installing it on virtual machine like <a href="https://www.virtualbox.org/">VirtualBox</a>. Set your VirtualBox machine's network mode to <i>Bridged Adapter</i> so it will get an IP address on your network for easy access.
</div>
</div>

<div class="message is-danger">
<div class="message-body">
<p>There is one thing I <strong>strongly recommend</strong> you to do first before anything else,
and that is <strong>disable password based SSH logins.</strong> Instead, set up and use SSH-keys.
Your cloud service provider likely has good <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2">tutorials you can follow</a>.</p>

<p>If there is just one thing you do to secure your server, do this. There are bots constantly scanning
the Internet for servers with weak passwords. If you don't secure your server,
you <em>will</em> get hacked.</p>
</div>
</div>



## Step 2. Get and run the installer script

First, log in to your server as root. To download the installer script, you will need Git.
If you're using Debian, install it like this:

<pre class="console">apt install git</pre>

Next, download the setup script:

<pre class="console">git clone https://github.com/drawpile/dpserver.git</pre>

Now, you can run the setup script. This will download all the necessary components.

<pre class="console">cd dpserver
./setup.sh
</pre>

The script will first download and install Docker, then the it will ask you some questions
about the server environment. Specifically:

 * Your domain name. If you don't have one, use your server's IP address
 * Whether you want to use Let's Encrypt. You will need a domain name for this to work.
 * If you have a Discord channel where you'd like to relay your server abuse reports

At this point, no server is actually started. If you wish, you can make additional customizations first.
The setup script will write a file named `.env`. You can modify this file later yourself.

Docker-compose is used to manage the actual server processes. Out of the box, the docker-compose file will provide you with:

 * The Drawpile server itself
 * A [list server](https://github.com/drawpile/listserver) (that just shows the active sessions by default)
 * An [abuse report bridge](https://github.com/drawpile/abusereport) (relays server abuse reports to a Discord webhook)
 * A web server
 * Let's Encrypt SSL certificate for the web server
 * [Web admin](https://github.com/drawpile/dpwebadmin)

See the [readme file](https://github.com/drawpile/dpserver/blob/master/README.md) for more information
on how to customize the server package. For example, if you already have a web server, you will not
want to use the nginx server included in the docker-compose file.

## Step 3. Run the server

Once you're satisfied with the configuration, you can try starting the server up:

<pre class="console">docker-compose up</pre>

The server will shut down when you hit Ctrl+C. To start the server and leave it running
in the background, use:

<pre class="console">docker-compose up -d</pre>

To update the server components, run `docker-compose pull`, followed by `docker-compose up -d` to restart
the changed services.

You can update the web admin to the latest version by running the `./update-webadmin.sh` script.

{% endfilter %}
</article>
{% endblock %}

